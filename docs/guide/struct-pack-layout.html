<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>memory layout of struct_pack | yalantinglibs</title>
    <meta name="description" content="A collection of C++20 libraries, include async_simple, coro_rpc and struct_pack.">
    <link rel="stylesheet" href="/yalantinglibs/assets/style.aba31698.css">
    <link rel="modulepreload" href="/yalantinglibs/assets/app.8a8ca21b.js">
    <link rel="modulepreload" href="/yalantinglibs/assets/guide_struct-pack-layout.md.ecabf61f.lean.js">
    
    <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-f44a984a><!--[--><!--]--><!--[--><span tabindex="-1" data-v-151f2593></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-151f2593> Skip to content </a><!--]--><!----><header class="VPNav" data-v-f44a984a data-v-a50780ff><div class="VPNavBar has-sidebar" data-v-a50780ff data-v-6f1d18b5><div class="container" data-v-6f1d18b5><div class="VPNavBarTitle has-sidebar" data-v-6f1d18b5 data-v-d5925166><a class="title" href="/yalantinglibs/" data-v-d5925166><!--[--><!--]--><!----><!--[-->yalantinglibs<!--]--><!--[--><!--]--></a></div><div class="content" data-v-6f1d18b5><!--[--><!--]--><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6f1d18b5 data-v-f83db6ba><span id="main-nav-aria-label" class="visually-hidden" data-v-f83db6ba>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/yalantinglibs/guide/what-is-yalantinglibs.html" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->Guide<!--]--><!----></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-f83db6ba data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6ffb57d3><span class="text" data-v-6ffb57d3><!----> Language <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6ffb57d3><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><div class="items" data-v-1c5d0cfc><!--[--><!--[--><div class="VPMenuLink" data-v-1c5d0cfc data-v-e8e0fb1d><a class="VPLink link" href="/yalantinglibs/guide/what-is-yalantinglibs.html" data-v-e8e0fb1d data-v-3c355974><!--[-->English<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-1c5d0cfc data-v-e8e0fb1d><a class="VPLink link" href="/yalantinglibs/zh/guide/what-is-yalantinglibs.html" data-v-e8e0fb1d data-v-3c355974><!--[-->简体中文<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="https://github.com/alibaba/yalantinglibs/issues" target="_blank" rel="noreferrer" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->Github Issues<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6f1d18b5 data-v-a3e7452b><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-a3e7452b data-v-481098f9 data-v-eba7420e><span class="check" data-v-eba7420e><span class="icon" data-v-eba7420e><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-481098f9><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-481098f9><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6f1d18b5 data-v-738bef5a data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://github.com/alibaba/yalantinglibs" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6f1d18b5 data-v-e4361c82 data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-6ffb57d3><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-6ffb57d3><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><!----><!--[--><!--[--><!----><div class="group" data-v-e4361c82><div class="item appearance" data-v-e4361c82><p class="label" data-v-e4361c82>Appearance</p><div class="appearance-action" data-v-e4361c82><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-e4361c82 data-v-481098f9 data-v-eba7420e><span class="check" data-v-eba7420e><span class="icon" data-v-eba7420e><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-481098f9><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-481098f9><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-e4361c82><div class="item social-links" data-v-e4361c82><div class="VPSocialLinks social-links-list" data-v-e4361c82 data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://github.com/alibaba/yalantinglibs" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6f1d18b5 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div><!----></header><div class="VPLocalNav" data-v-f44a984a data-v-b6162a8b><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-b6162a8b><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-b6162a8b><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-b6162a8b>Menu</span></button><a class="top-link" href="#" data-v-b6162a8b> Return to top </a></div><aside class="VPSidebar" data-v-f44a984a data-v-a186aa16><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-a186aa16><span class="visually-hidden" id="sidebar-aria-label" data-v-a186aa16> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-a186aa16><section class="VPSidebarGroup collapsible" data-v-a186aa16 data-v-6e45c352><div class="title" role="button" data-v-6e45c352><h2 class="title-text" data-v-6e45c352>how to use?</h2><div class="action" data-v-6e45c352><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-6e45c352><!--[--><!--[--><a class="VPLink link link" href="/yalantinglibs/guide/how-to-use-as-git-submodule.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>Use as Git Submodule</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/yalantinglibs/guide/how-to-use-by-cmake-find_package.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>Use by CMake find_package</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-a186aa16><section class="VPSidebarGroup collapsible" data-v-a186aa16 data-v-6e45c352><div class="title" role="button" data-v-6e45c352><h2 class="title-text" data-v-6e45c352>struct_pack</h2><div class="action" data-v-6e45c352><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-6e45c352><!--[--><!--[--><a class="VPLink link link" href="/yalantinglibs/guide/struct-pack-intro.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>What is struct_pack?</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link active" href="/yalantinglibs/guide/struct-pack-layout.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>struct_pack layout</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/yalantinglibs/guide/struct-pack-type-system.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>struct_pack type system</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="https://alibaba.github.io/yalantinglibs/en/html/group__struct__pack.html" target="_blank" rel="noreferrer" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>API Reference</span><!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="icon" data-v-3c355974><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-a186aa16><section class="VPSidebarGroup collapsible" data-v-a186aa16 data-v-6e45c352><div class="title" role="button" data-v-6e45c352><h2 class="title-text" data-v-6e45c352>struct_pb</h2><div class="action" data-v-6e45c352><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-6e45c352><!--[--><!--[--><a class="VPLink link link" href="/yalantinglibs/guide/struct-pb-intro.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>What is struct_pb?</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/yalantinglibs/guide/struct-pb-quick-start.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>Quick Start</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/yalantinglibs/guide/struct-pb-supported-features.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>Supported Features</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/yalantinglibs/guide/struct-pb-guide-proto3.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>Guide (proto3)</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/yalantinglibs/guide/struct-pb-generating-your-struct.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>Generating your struct</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/yalantinglibs/guide/struct-pb-api.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>struct_pb API</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-a186aa16><section class="VPSidebarGroup collapsible" data-v-a186aa16 data-v-6e45c352><div class="title" role="button" data-v-6e45c352><h2 class="title-text" data-v-6e45c352>coro_rpc</h2><div class="action" data-v-6e45c352><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-6e45c352><!--[--><!--[--><a class="VPLink link link" href="/yalantinglibs/guide/coro-rpc-intro.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>What is coro_rpc?</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-f44a984a data-v-d981fe29><div class="VPDoc has-sidebar has-aside" data-v-d981fe29 data-v-cfb513e0><div class="container" data-v-cfb513e0><div class="aside" data-v-cfb513e0><div class="aside-curtain" data-v-cfb513e0></div><div class="aside-container" data-v-cfb513e0><div class="aside-content" data-v-cfb513e0><div class="VPDocAside" data-v-cfb513e0 data-v-afc4c1a1><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-afc4c1a1 data-v-2865c0b0><div class="content" data-v-2865c0b0><div class="outline-marker" data-v-2865c0b0></div><div class="outline-title" data-v-2865c0b0>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-2865c0b0><span class="visually-hidden" id="doc-outline-aria-label" data-v-2865c0b0> Table of Contents for current page </span><ul class="root" data-v-2865c0b0 data-v-1188541a><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-afc4c1a1></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-cfb513e0><div class="content-container" data-v-cfb513e0><!--[--><!--]--><main class="main" data-v-cfb513e0><div style="position:relative;" class="vp-doc _yalantinglibs_guide_struct-pack-layout" data-v-cfb513e0><div><h1 id="memory-layout-of-struct-pack" tabindex="-1">memory layout of struct_pack <a class="header-anchor" href="#memory-layout-of-struct-pack" aria-hidden="true">#</a></h1><p><strong>By Default</strong>, the memory layout of struct_pack is shown in the figure bellow:</p><p><img src="/yalantinglibs/assets/memory_layout1.6cabe2e8.svg" alt=""></p><p>It contains 4 bytes of <code>type hash</code>, followed by the data payload of variable length depends on the object provided by user.</p><p>The default memory layout applies when <strong>both</strong> of the following conditions are met:</p><ol><li>struct_pack does not contain the compatible field</li><li>struct_pack does not store full type information</li><li>the maximum length of struct_pack&#39;s container is less than 256</li></ol><p>In the <strong>default case</strong>, struct_pack could omit meta information for a more compact memory layout.</p><p>However, in the <strong>Non-default case</strong>, struct_pack must contain the <strong>meta information</strong> field, at which point the complete memory layout is shown as below:</p><p><img src="/yalantinglibs/assets/memory_layout2.642e7170.svg" alt=""></p><p>The layout of each field will be described in the following sections.</p><h1 id="_1-type-hash-mandatory" tabindex="-1">1. type hash(Mandatory) <a class="header-anchor" href="#_1-type-hash-mandatory" aria-hidden="true">#</a></h1><p>The type hash is located in the header of struct_pack and is 4 bytes in total. It is used for type-checking of struct_pack.</p><p>Higher 31 bits: type hash data. It is the higher 31 bit of the MD5 hash result of the struct_pack type information.</p><p>Lower 1 bit： meta information flag</p><p><img src="/yalantinglibs/assets/hash_info.d594cbe0.svg" alt=""></p><h1 id="_2-meta-information-optional" tabindex="-1">2. meta information(Optional) <a class="header-anchor" href="#_2-meta-information-optional" aria-hidden="true">#</a></h1><p>When meta information flag in type hash is 1, struct_pack will contain the meta-information field. The meta-information consists of a one-byte meta-information header and a number of bytes of meta-information.</p><h2 id="_2-1-header" tabindex="-1">2.1 header <a class="header-anchor" href="#_2-1-header" aria-hidden="true">#</a></h2><p>The meta information header is one byte in total, which describes the configuration of one struct_pack object.</p><p>The detailed layout is shown figure in bellow:</p><p><img src="/yalantinglibs/assets/meta_info.640e2e20.svg" alt=""></p><p>Current configurations are:</p><table><thead><tr><th>Configuration</th><th>Contents</th><th>Bit location</th><th>Dependency</th><th>Configurable</th></tr></thead><tbody><tr><td>DATA_SIZE</td><td>DATA_SIZE represents the total bytes of the serialization result, when compatible fields exist</td><td>0b000000**</td><td>depends on compatible field</td><td>N</td></tr><tr><td>ADD_TYPE_INFO</td><td>A flag indicates if full type information exists</td><td>0b00000*00</td><td>Release(0) Debug(1); Could be set by user manually</td><td>Y</td></tr><tr><td>LEN_SIZE</td><td>Number of bytes occupied by the containers</td><td>0b000**000</td><td>Depends on the latest data container in the encoded result</td><td>N</td></tr></tbody></table><ol><li><code>DATA_SIZE</code>(2 bits). When <code>compatible&lt;T&gt;</code> fields are present, we need to record the total data length. so</li></ol><ul><li>00 : total data length field not present(so that no compatible fields)</li><li>01 : total data length is recorded in a data field of 2 bytes</li><li>10 : total data length is recorded in a data field of 4 bytes</li><li>11 : total data length is recorded in a data field of 9 bytes</li></ul><ol start="2"><li><code>ADD_TYPE_INFO</code>(1 bit). It is a flag indicating if type information is present</li></ol><ul><li>0 : full type information not present (0 in release mode)</li><li>1 : full type information present</li></ul><ol start="3"><li><code>LEN_SIZE</code> (2 bits). It records the maximum number of bytes of the containers.</li></ol><ul><li>00 : 1 byte (in range of uint8_t, 0~256)</li><li>01 : 2 bytes (in range of uint16_t)</li><li>10 : 4 bytes (in range of uint32_t)</li><li>11 : 8 bytes (in range of uint64_t)</li></ul><ol start="4"><li><code>RESERVED</code>(3 bits).</li></ol><h2 id="_2-2-total-data-length-optional" tabindex="-1">2.2 total data length(Optional) <a class="header-anchor" href="#_2-2-total-data-length-optional" aria-hidden="true">#</a></h2><p>The length of this field depends on <code>DATA_SIZE</code>(2/4/8bytes). It is a unsigned integer represents the total length of the struct_pack data.</p><h2 id="_2-3-full-type-information-optional" tabindex="-1">2.3 full type information(Optional) <a class="header-anchor" href="#_2-3-full-type-information-optional" aria-hidden="true">#</a></h2><p>This field is a &#39;\0&#39; tailed string, which represents one legal struct_pack type. The full type information is recorded by this string and the MD5 hash value of this field is used to get the <code>type hash</code> higher 31 bits.</p><p>The length of this field could be determined at compile time if it passed validation. However, it&#39;s length could only be determined by the position of char <code>&#39;\0&#39;</code> when validation failed.</p><p>The encoding rules for this field and its mapping to the struct_pack type tree can be found in<a href="https://alibaba.github.io/yalantinglibs/guide/struct-pack-type-system.html" target="_blank" rel="noreferrer">struct_pack type system</a></p><p>Take the following type as an example:</p><div class="language-cpp"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">struct</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">person</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">int</span><span style="color:#F07178;"> age</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">std</span><span style="color:#89DDFF;">::</span><span style="color:#F07178;">string name</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><p>Its type info is as follows:</p><p><img src="/yalantinglibs/assets/person_type_info.5863fe19.svg" alt="类型信息"></p><p>We can see that type info ends with <code>\0</code>.</p><h1 id="_3-known-data-payload-mandatory" tabindex="-1">3. known data payload(Mandatory) <a class="header-anchor" href="#_3-known-data-payload-mandatory" aria-hidden="true">#</a></h1><p>Serialization results of all known data fields could be found in this payload.</p><h2 id="_3-1-structural-data" tabindex="-1">3.1 Structural data <a class="header-anchor" href="#_3-1-structural-data" aria-hidden="true">#</a></h2><p>Structural data types(such as struct, class, pair, tuple and so on) is a data container of defined data field. In struct_pack, all data fields in one struct are Sequential placed in the memory in the order of their definition in struct, and no more additional information required in this kind of memory layout.</p><p>For example, if we define a struct person as bellow:</p><div class="language-cpp"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">struct</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">person</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">int</span><span style="color:#F07178;"> age</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">std</span><span style="color:#89DDFF;">::</span><span style="color:#F07178;">string name</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><p>In release mode, the serialization of one <code>person{.age=24,.name=&quot;Betty&quot;}</code> object could be:</p><p><img src="/yalantinglibs/assets/release_person.8a54deb1.svg" alt="person in release mode"></p><p>No meta information in the figure above because it&#39;s zeros and could be omitted by default.</p><p>However, in debug mode, additional meta information will be inserted into the serialization result to avoid hash conflicts, as shown bellow:</p><p><img src="/yalantinglibs/assets/debug_person.877a20d2.svg" alt="person in debug mode"></p><p>As demonstrated, the meta header is <code>0x04</code>, which indicates type information is available.</p><p>And serialization of one <code>person{.age=24,.name=std::string{256,&#39;A&#39;}}</code> object in release mode is:</p><p><img src="/yalantinglibs/assets/release_person_long_name.d1a06201.svg" alt=""> where the meta information header is <code>0x08</code>, which indicates a <code>size_type</code> length of <code>2</code> bytes.</p><h2 id="_3-2-fundamental-types" tabindex="-1">3.2 fundamental types <a class="header-anchor" href="#_3-2-fundamental-types" aria-hidden="true">#</a></h2><p>All fundamental types(such as signed and unsigned integers, floating-point types, character types, enum and boolean) have definitive length.</p><h3 id="fix-sized-unsigned-integers" tabindex="-1">fix-sized unsigned integers <a class="header-anchor" href="#fix-sized-unsigned-integers" aria-hidden="true">#</a></h3><table><thead><tr><th>type</th><th>length(bytes)</th><th>format</th></tr></thead><tbody><tr><td>uint8_t</td><td>1</td><td>original code</td></tr><tr><td>uint16_t</td><td>2</td><td>original code</td></tr><tr><td>uint32_t</td><td>4</td><td>original code</td></tr><tr><td>uint64_t</td><td>8</td><td>original code</td></tr></tbody></table><h3 id="fix-sized-unsigned-integers-1" tabindex="-1">fix-sized unsigned integers <a class="header-anchor" href="#fix-sized-unsigned-integers-1" aria-hidden="true">#</a></h3><table><thead><tr><th>type</th><th>length(bytes)</th><th>format</th></tr></thead><tbody><tr><td>int8_t</td><td>1</td><td>two&#39;s Complement</td></tr><tr><td>int16_t</td><td>2</td><td>two&#39;s Complement</td></tr><tr><td>int32_t</td><td>4</td><td>two&#39;s Complement</td></tr><tr><td>int64_t</td><td>8</td><td>two&#39;s Complement</td></tr></tbody></table><h3 id="fix-sized-unsigned-integers-2" tabindex="-1">fix-sized unsigned integers <a class="header-anchor" href="#fix-sized-unsigned-integers-2" aria-hidden="true">#</a></h3><table><thead><tr><th>type</th><th>length(bytes)</th><th>format</th></tr></thead><tbody><tr><td>struct_pack::var_uint32_t</td><td>1-5 (variant length)</td><td>varint</td></tr><tr><td>struct_pack::var_uint64_t</td><td>1-10(variant length)</td><td>varint</td></tr></tbody></table><h3 id="variant-length-signed-integers" tabindex="-1">variant length signed integers <a class="header-anchor" href="#variant-length-signed-integers" aria-hidden="true">#</a></h3><table><thead><tr><th>type</th><th>length(bytes)</th><th>format</th></tr></thead><tbody><tr><td>struct_pack::var_int32_t</td><td>1-5 (variant length)</td><td>zigzag + varint</td></tr><tr><td>struct_pack::var_int64_t</td><td>1-10(variant length)</td><td>zigzag + varint</td></tr></tbody></table><h3 id="fix-sized-floating-point-types" tabindex="-1">fix-sized floating-point types <a class="header-anchor" href="#fix-sized-floating-point-types" aria-hidden="true">#</a></h3><table><thead><tr><th>type</th><th>length(bytes))</th><th>format</th></tr></thead><tbody><tr><td>float</td><td>4</td><td>IEEE 754 single-precision</td></tr><tr><td>double</td><td>8</td><td>IEEE 754 double-precision</td></tr></tbody></table><h3 id="fix-sized-character-types" tabindex="-1">fix-sized character types <a class="header-anchor" href="#fix-sized-character-types" aria-hidden="true">#</a></h3><table><thead><tr><th>type</th><th>length(bytes))</th><th>format</th></tr></thead><tbody><tr><td>char8_t</td><td>1</td><td>original code</td></tr><tr><td>char16_t</td><td>2</td><td>original code</td></tr><tr><td>char32_t</td><td>4</td><td>original code</td></tr><tr><td>wchar_t</td><td>Platform-dependent</td><td>original code</td></tr></tbody></table><h3 id="enum" tabindex="-1">enum <a class="header-anchor" href="#enum" aria-hidden="true">#</a></h3><p>Enum types shares the same memory layout with the corresponding integer types.</p><h3 id="boolean" tabindex="-1">boolean <a class="header-anchor" href="#boolean" aria-hidden="true">#</a></h3><p>Boolean takes on byte. It is <code>false</code> if all bits of this byte are 0 and true otherwise.</p><h2 id="_3-3-data-containers" tabindex="-1">3.3 data containers <a class="header-anchor" href="#_3-3-data-containers" aria-hidden="true">#</a></h2><p>Most data structures are supported in struct_pack and each of them has its dedicated memory layout.</p><h3 id="fixed-length-arrays" tabindex="-1">fixed-length arrays <a class="header-anchor" href="#fixed-length-arrays" aria-hidden="true">#</a></h3><p>For C-style array, C++ <code>std::array</code> or user-defined arrays, array length information is not stored because it is known in compile time. All elements are encoded by individually coding the elements of the array in their natural order, 0 through n -1.</p><p>For instance, serialization of <code>std::array&lt;int,2&gt;{24,42}</code> is encoded as the figure bellow:</p><p><img src="/yalantinglibs/assets/array_layout.66a9423e.svg" alt=""></p><h3 id="sequential-containers" tabindex="-1">sequential containers <a class="header-anchor" href="#sequential-containers" aria-hidden="true">#</a></h3><p>For Sequential containers such as <code>std::vector</code>,<code>std::deque</code>,<code>std::list</code>,<code>std::string</code> or any user-defined structures, the serialization begins with the number of elements of <code>size_type</code>, then all elements are encoded in their natural order.</p><p>For example, an <code>std::string{&quot;Hello&quot;}</code> could be encoded as bellow:</p><p><img src="/yalantinglibs/assets/string_layout.b0ba0eca.svg" alt=""></p><h3 id="set" tabindex="-1">set <a class="header-anchor" href="#set" aria-hidden="true">#</a></h3><p>For <code>std::set</code> or user-defined set, the memory layout begins with the elements count of <code>size_type</code>, followed by the numbers of <code>keys</code> in this set.</p><p>For example, a <code>std::set&lt;int&gt;{42,24}</code> could be encoded as:</p><p><img src="/yalantinglibs/assets/set_layout.884cebcd.svg" alt=""></p><h3 id="map" tabindex="-1">map <a class="header-anchor" href="#map" aria-hidden="true">#</a></h3><p>For <code>std::map&lt;K,V&gt;</code> or similar user-defined data, the memory layout begins with number of elements of type <code>size_type</code>, followed by each data field of <code>value_type</code>.</p><p>For example, a</p><div class="language-cpp"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki"><code><span class="line"><span style="color:#FFCB6B;">std</span><span style="color:#89DDFF;">::</span><span style="color:#A6ACCD;">map</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">int</span><span style="color:#89DDFF;">,</span><span style="color:#FFCB6B;">std</span><span style="color:#89DDFF;">::</span><span style="color:#A6ACCD;">string</span><span style="color:#89DDFF;">&gt;{{</span><span style="color:#F78C6C;">42</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Hello</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">},{</span><span style="color:#F78C6C;">24</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Student</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">}}</span></span>
<span class="line"></span></code></pre></div><p>is encoded as:</p><p><img src="/yalantinglibs/assets/map_layout.9983cecb.svg" alt=""></p><h3 id="optional-t" tabindex="-1"><code>optional&lt;T&gt;</code> <a class="header-anchor" href="#optional-t" aria-hidden="true">#</a></h3><p>For <code>std::optional&lt;T&gt;</code> or similar user-defined data, it begins with a bool indicates if the value is present or not. The value will be followed by this bool field if it is present.</p><p>For example, <code>std::optional&lt;int&gt;{42}</code> is encoded as:</p><p><img src="/yalantinglibs/assets/optional_has_value.9d7ef29a.svg" alt=""></p><p>And a <code>std::optional&lt;int&gt;{std::nullopt}</code> is encoded as:</p><p><img src="/yalantinglibs/assets/optional_null.0d9ffde0.svg" alt=""></p><h3 id="variant" tabindex="-1">variant <a class="header-anchor" href="#variant" aria-hidden="true">#</a></h3><p>For <code>std::variant</code> or similar user-defined data, it begins with one byte carrying the <code>variant index</code> information, of unsigned integer type, indicating the real type stored in it. Then it is followed by the encoded data of the real data type.</p><p>For example, <code>std::variant&lt;int,std::string,double&gt;{3.14}</code> is encoded as:</p><p><img src="/yalantinglibs/assets/variant.f23b026d.svg" alt=""></p><h3 id="expected-t-e" tabindex="-1">expected&lt;T,E&gt; <a class="header-anchor" href="#expected-t-e" aria-hidden="true">#</a></h3><p>For <code>std::expected&lt;T,E&gt;</code> or similar user-defined data, it begins with a boolean type. When the header is true, the <code>expected</code> value is present so the memory layout is followed by the encoded value <code>T</code>. When the header is false, the error code is present so it is followed by the encoded error code.</p><p>For example, <code>std::expected&lt;int,std::errc&gt;{42}</code> is encoded as:</p><p><img src="/yalantinglibs/assets/variant.f23b026d.svg" alt=""></p><p>and <code>std::expect&lt;int,std::errc&gt;{std::unexpected{std::errc::no_buffer_space}}</code> is encoded as bellow:</p><p><img src="/yalantinglibs/assets/variant_with_error.8426eb66.svg" alt=""></p><h3 id="monostate" tabindex="-1">monostate <a class="header-anchor" href="#monostate" aria-hidden="true">#</a></h3><p>It is an empty type and encoded as zero length.</p><h1 id="_4-unknown-fields-optional" tabindex="-1">4. Unknown fields(Optional) <a class="header-anchor" href="#_4-unknown-fields-optional" aria-hidden="true">#</a></h1><p>For backward/forward compatibility, new added fields are of type <code>struct_pack::compatible&lt;T&gt;</code> be appended at the end of the object. If <code>compatible&lt;T&gt;</code> is present, the total data size <strong>must</strong> be stored in the meta information.</p><p>During deserialization, unknown <code>compatible&lt;T&gt;</code> fields are omitted and skipped. For <code>compatible&lt;T&gt;</code> fields not present, it is desensitized as empty value.</p><p>Each <code>compatible&lt;T&gt;</code> are placed in the same order as they are defined in the structure. And each <code>compatible&lt;T&gt;</code> field is encoded in the same way as <code>optional&lt;T&gt;</code> field.s</p><p>For example,</p><div class="language-cpp"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">struct</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">person</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">int</span><span style="color:#F07178;"> age</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">std</span><span style="color:#89DDFF;">::</span><span style="color:#F07178;">string name</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">struct_pack</span><span style="color:#89DDFF;">::</span><span style="color:#F07178;">compatible</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">double</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> salary</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><p>In release mode, object <code>person{.age=24,.name=&quot;Betty&quot;,.salary=2000.0}</code> is encoded as:</p><p><img src="/yalantinglibs/assets/release_person_with_compatible.69a839c8.svg" alt=""></p><p>In the figure above, the meta information header is <code>0x01</code>, which means <code>compatible&lt;T&gt;</code> is contained and the total length is less than 65536.</p></div></div></main><!--[--><!--]--><footer class="VPDocFooter" data-v-cfb513e0 data-v-21f75714><!----><div class="prev-next" data-v-21f75714><div class="pager" data-v-21f75714><a class="pager-link prev" href="/yalantinglibs/guide/struct-pack-intro.html" data-v-21f75714><span class="desc" data-v-21f75714>Previous page</span><span class="title" data-v-21f75714>What is struct_pack?</span></a></div><div class="has-prev pager" data-v-21f75714><a class="pager-link next" href="/yalantinglibs/guide/struct-pack-type-system.html" data-v-21f75714><span class="desc" data-v-21f75714>Next page</span><span class="title" data-v-21f75714>struct_pack type system</span></a></div></div></footer><!--[--><!--]--></div></div></div></div></div><footer class="VPFooter has-sidebar" data-v-f44a984a data-v-9f24cc86><div class="container" data-v-9f24cc86><p class="message" data-v-9f24cc86>This website is released under the MIT License.</p><p class="copyright" data-v-9f24cc86>Copyright © 2022 yalantinglibs contributors</p></div></footer><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"readme.md\":\"23622731\",\"guide_coro-rpc-intro.md\":\"10c31d52\",\"guide_how-to-use-as-git-submodule.md\":\"9e5d8093\",\"guide_how-to-use-by-cmake-find_package.md\":\"6759a4e7\",\"guide_struct-pack-intro.md\":\"b0d6f328\",\"guide_struct-pack-layout.md\":\"ecabf61f\",\"guide_struct-pack-type-system.md\":\"9ffcc2bd\",\"guide_struct-pb-api.md\":\"e7fb5c1b\",\"guide_struct-pb-generating-your-struct.md\":\"53e335b9\",\"guide_struct-pb-guide-proto3.md\":\"37bde064\",\"guide_struct-pb-intro.md\":\"0611153e\",\"guide_struct-pb-quick-start.md\":\"8164c1ae\",\"guide_struct-pb-supported-features.md\":\"f8bea069\",\"guide_what-is-yalantinglibs.md\":\"2a394276\",\"how-to-use-as-git-submodule.md\":\"2fb40fc0\",\"how-to-use-by-cmake-find_package.md\":\"c170b871\",\"index.md\":\"5b0f68c2\",\"zh_guide_coro-rpc-intro.md\":\"d292dd36\",\"zh_guide_struct-pack-intro.md\":\"e199425c\",\"zh_guide_struct-pack-layout.md\":\"4207e822\",\"zh_guide_struct-pack-type-system.md\":\"e3cabf69\",\"zh_guide_what-is-yalantinglibs.md\":\"a7a5ddfd\"}")</script>
    <script type="module" async src="/yalantinglibs/assets/app.8a8ca21b.js"></script>
    
  </body>
</html>